import ast
import pandas as pd

# Function to extract parameterized variables and method parameters within the test_main function
def extract_test_main_content(file_path):
    with open(file_path, 'r') as file:
        try:
            tree = ast.parse(file.read())
            for node in ast.walk(tree):
                if isinstance(node, ast.FunctionDef) and node.name == 'test_main':
                    param_variables = set()
                    param_method_params = set()
                    for var in ast.walk(node):
                        if isinstance(var, ast.Assign):
                            for target in var.targets:
                                if isinstance(target, ast.Name):
                                    value = var.value
                                    if isinstance(value, (ast.Str, ast.FormattedValue)):
                                        value_str = ast.dump(value)
                                        if ('{' in value_str or '}' in value_str or '"' in value_str):
                                            param_variables.add(target.id)
                    for method_node in ast.walk(node):
                        if isinstance(method_node, ast.Call):
                            for kw in method_node.keywords:
                                kw_value = kw.value
                                if (
                                    isinstance(kw_value, ast.Name) and
                                    kw_value.id == kw.arg and
                                    kw.arg not in param_variables
                                ):
                                    param_method_params.add(kw.arg)

                    return list(param_variables), list(param_method_params)
        except SyntaxError as e:
            print(f"Syntax error in {file_path}: {e})

    return None, None

# Input Python file path
python_file_path = 'your_python_file.py'

# Extract parameterized variable names and method parameters within the test_main function
param_variables, param_method_params = extract_test_main_content(python_file_path)

# Create a DataFrame with parameterized variable names and method parameters as column headers
if param_variables or param_method_params:
    param_variables_and_method_params = param_variables + param_method_params
    df = pd.DataFrame({var: [] for var in param_variables_and_method_params})
    excel_output_file = 'output.xlsx'
    df.to_excel(excel_output_file, index=False)
    print(f"Parameterized variable names and method parameters extracted and saved to {excel_output_file}.")

# Print parameterized variable names and method parameters
if param_variables:
    print(f"Parameterized Variable Names: {', '.join(param_variables)}")

if param_method_params:
    print(f"Parameterized Method Parameters: {', '.join(param_method_params)}")













for method_node in ast.walk(node):
                        if isinstance(method_node, ast.Call):
                            for kw in method_node.keywords:
                                kw_value = kw.value
                                if isinstance(kw_value, ast.Name) and kw_value.id == kw.arg:
                                    if kw_value.id not in param_variables:
                                        param_method_params.add(kw.arg)
                                elif isinstance(kw_value, ast.FormattedValue):
                                    # Check if the value is enclosed in curly braces {}
                                    if isinstance(kw_value.value, ast.Name) and kw_value.value.id == kw.arg:
                                        param_method_params.add(kw.arg)
