import ast
import pandas as pd

# Function to extract method parameters and variables within the test_main function
def extract_test_main_content(file_path):
    with open(file_path, 'r') as file:
        try:
            tree = ast.parse(file.read())
            for node in ast.walk(tree):
                if isinstance(node, ast.FunctionDef) and node.name == 'test_main':
                    # Extract variable names and method parameters that are parameterized
                    variable_names = set()
                    method_params = set()
                    for var in ast.walk(node):
                        if isinstance(var, ast.Name) and not isinstance(var.ctx, ast.Load):
                            variable_names.add(var.id)
                    for method_node in ast.walk(node):
                        if isinstance(method_node, ast.Call):
                            for kw in method_node.keywords:
                                if isinstance(kw.value, ast.Str):
                                    value = kw.value.s
                                    if '{' in value or '}' in value or '"' in value:
                                        method_params.add(kw.arg)

                    # Extract code within the test_main function
                    code = ast.dump(node)

                    return list(variable_names), list(method_params), code
        except SyntaxError as e:
            print(f"Syntax error in {file_path}: {e})

    return None, None, None

# Input Python file path
python_file_path = 'your_python_file.py'

# Extract variable names and method parameters within the test_main function
variable_names, method_params, code = extract_test_main_content(python_file_path)

# Create a DataFrame with variable names and method parameters as column headers
if variable_names or method_params:
    param_variables = variable_names + method_params
    df = pd.DataFrame({pv: [] for pv in param_variables})
    excel_output_file = 'output.xlsx'
    df.to_excel(excel_output_file, index=False)
    print(f"Variable names and method parameters extracted and saved to {excel_output_file}.")

# Print variable names and method parameters
if variable_names:
    print(f"Variable Names: {', '.join(variable_names)}")

if method_params:
    print(f"Method Parameters: {', '.join(method_params)}")
