import pandas as pd
import os
import shutil

# Function to update or create test case Python files
def update_or_create_test_cases(test_folder, excel_data, original_python_file):
    for index, row in excel_data.iterrows():
        test_case_name = row['test_case_name']
        python_file_path = os.path.join(test_folder, f'test_{test_case_name}.py')

        # Check if the test case Python file already exists
        if os.path.isfile(python_file_path):
            with open(python_file_path, 'r') as file:
                python_code = file.read()

            # Update variables and method parameters with new values from Excel
            for column in excel_data.columns:
                if column != 'test_case_name':
                    excel_value = str(row[column])
                    if excel_value:
                        python_code = python_code.replace(f'{{{column}}}', excel_value)

            # Write the modified code back to the test case Python file
            with open(python_file_path, 'w') as file:
                file.write(python_code)

            print(f"Updated test case {test_case_name} in {python_file_path}")
        else:
            # Create a new test case Python file based on the original Python file
            shutil.copy(original_python_file, python_file_path)

            # Read the newly created Python file
            with open(python_file_path, 'r') as file:
                python_code = file.read()

            # Update variables and method parameters with new values from Excel
            for column in excel_data.columns:
                if column != 'test_case_name':
                    excel_value = str(row[column])
                    if excel_value:
                        python_code = python_code.replace(f'{{{column}}}', excel_value)

            # Write the modified code back to the new test case Python file
            with open(python_file_path, 'w') as file:
                file.write(python_code)

            print(f"Created test case {test_case_name} in {python_file_path}")

# Input Excel file path, test folder path, and original Python file path
excel_file_path = 'test_data.xlsx'
test_folder_path = 'test_folder'
original_python_file = 'original_test_file.py'

# Create the test folder if it doesn't exist
os.makedirs(test_folder_path, exist_ok=True)

# Read the Excel file with test case details
excel_data = pd.read_excel(excel_file_path)

# Update or create test cases based on Excel data
update_or_create_test_cases(test_folder_path, excel_data, original_python_file)
