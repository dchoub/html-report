import ast
import pandas as pd

# Function to extract parameterized variables and method parameters within the test_main function
def extract_test_main_content(file_path):
    with open(file_path, 'r') as file:
        try:
            tree = ast.parse(file.read())
            for node in ast.walk(tree):
                if isinstance(node, ast.FunctionDef) and node.name == 'test_main':
                    param_variables = set()
                    param_method_params = set()
                    for var in ast.walk(node):
                        if isinstance(var, ast.Assign):
                            for target in var.targets:
                                if isinstance(target, ast.Name):
                                    value = var.value
                                    if isinstance(value, (ast.Str, ast.FormattedValue)):
                                        value_str = ast.dump(value)
                                        if ('{' in value_str or '}' in value_str or '"' in value_str):
                                            param_variables.add(target.id)
                    for method_node in ast.walk(node):
                        if isinstance(method_node, ast.Call):
                            for kw in method_node.keywords:
                                kw_value = kw.value
                                if (
                                    isinstance(kw_value, ast.Name) and
                                    kw_value.id == kw.arg and
                                    kw.arg not in param_variables
                                ):
                                    param_method_params.add(kw.arg)

                    return list(param_variables), list(param_method_params)
        except SyntaxError as e:
            print(f"Syntax error in {file_path}: {e})

    return None, None

# Input Python file path
python_file_path = 'your_python_file.py'

# Extract parameterized variable names and method parameters within the test_main function
param_variables, param_method_params = extract_test_main_content(python_file_path)

# Create a DataFrame with parameterized variable names and method parameters as column headers
if param_variables or param_method_params:
    param_variables_and_method_params = param_variables + param_method_params
    df = pd.DataFrame({var: [] for var in param_variables_and_method_params})
    excel_output_file = 'output.xlsx'
    df.to_excel(excel_output_file, index=False)
    print(f"Parameterized variable names and method parameters extracted and saved to {excel_output_file}.")

# Print parameterized variable names and method parameters
if param_variables:
    print(f"Parameterized Variable Names: {', '.join(param_variables)}")

if param_method_params:
    print(f"Parameterized Method Parameters: {', '.join(param_method_params)}")











for method_node in ast.walk(node):
                        if isinstance(method_node, ast.Call):
                            for kw in method_node.keywords:
                                kw_value = kw.value
                                if (
                                    isinstance(kw_value, ast.JoinedStr) and
                                    len(kw_value.values) == 1 and
                                    isinstance(kw_value.values[0], ast.FormattedValue) and
                                    isinstance(kw_value.values[0].value, ast.Name) and
                                    kw_value.values[0].value.id == kw.arg
                                ):
                                    param_method_params.add(kw.arg)






# Read the template file and existing test case file
with open('template.py', 'r') as template_file, open('test_case.py', 'r') as test_case_file:
    template_lines = template_file.readlines()
    test_case_lines = test_case_file.readlines()

# Initialize indices for template and test case lines
template_index = 0
test_case_index = 0

# Initialize a flag to check if a new line has been added
new_line_added = False

# Define a pattern for identifying parameterized variables
param_pattern = re.compile(r'{[^}]*}')

# Loop through the template lines
while template_index < len(template_lines):
    # Get the current lines from both files
    template_line = template_lines[template_index]
    test_case_line = test_case_lines[test_case_index] if test_case_index < len(test_case_lines) else None

    # Compare the lines
    if template_line == test_case_line:
        # Lines match, move to the next lines
        template_index += 1
        test_case_index += 1
    elif param_pattern.search(template_line):
        # Template line contains a parameterized variable, skip it
        template_index += 1
    else:
        # Lines don't match, add the template line to the test case at the appropriate position
        test_case_lines.insert(test_case_index, template_line)
        new_line_added = True
        template_index += 1

# Write the updated test case file
with open('test_case.py', 'w') as test_case_file:
    test_case_file.writelines(test_case_lines)

# Check if any new lines were added
if new_line_added:
    print("New lines from the template file have been added to the existing test case.")
else:
    print("No new lines were added.")



